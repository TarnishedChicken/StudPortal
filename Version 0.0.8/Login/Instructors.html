<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="/img/tcu.png">
  <link rel="stylesheet" href="/Styles/form.css" />
  <title>Instructor</title>
</head>
<body>
  <!--header-->
  <div class='header'>
    <button id='loginTab' class='tab selected' onclick='openTab(loginContent,loginTab)'><span>Log In</span></button>
    <button id='enrollTab' class='tab' onclick='openTab(enrollContent,enrollTab)'><span>Enroll</span></button>
  </div>
  
  <!--log tab container -->
  <div id='loginContent' class='tabContent selectedTab'>
    <div class="userChoice">
      <img src="/img/tcu.png" alt="University Logo" class="logo">
      <div class="title">
        <h1>Taguig City University</h1>
        <h3>Taguig City, Metro Manila</h3>
      </div>
    </div>


    <div class="student-badge">Instructor</div>



<div id="error-message" class="error-message"></div>
<div id="success-message" class="success-message"></div>
<form>
   
   <div class="form-group">
       <div class="input-container">
           <div class="input-icon"><i class="ri-user-fill"></i></div>
           <input id="username" type="text" class="form-input" placeholder="USER ID:" required>
       </div>
   </div>
   <div class="form-group">
      <div class="input-container">
        <div class="input-icon"><i class="ri-lock-2-fill"></i></div>
        <input type="password" id="password" class="form-input" placeholder="PASSWORD" 
          onkeypress="handleKeyPress(event)" required>
      </div>
    </div>
        
    <button onclick="validateLogin()" id="loginBtn" class="login-btn">LOGIN</button>
</form>


  
  
  <!--enroll tab container-->
  <div id='enrollContent' class='tabContent'>
    
  </div>
  <script>
        async function init(){
            mymodule = await import('../Functions/tcusias-module-package.js')
            mymodule = mymodule.default
            cookies = new mymodule.CookieHandler
            server = new mymodule.Server
            placeholder = new mymodule.Placeholders
        }
        init()
        //====validation function=====
        async function validateLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            hideMessages();
            
            if (!username || !password) {
                showError('Please fill in all fields.');
                return false;
            }
            
            
            if (await validateCredentials(username,password)) {
                showSuccess('Login successful! Redirecting...');

                setTimeout(() => {
                    window.location.href = '../Instructor-Home.html';
                }, 1500);
                
                return true;
            }
        }
        async function validateCredentials(uname,password){
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerHTML = 'LOGGING IN...';
            loginBtn.disabled = true;

            const res = await server.login({username:uname,password:password,usertype:"INSTRUCTOR"})
            console.log(res)
            if(res.id!="VALID_USER_ACCESS"){
                showError(res.message)
                const loginBtn = document.getElementById('loginBtn');
                loginBtn.innerHTML = 'LOGIN';
                loginBtn.disabled = false;
                return false
            }else {
                cookies.setCookie("session-id",res.session)
                return true
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                validateLogin(event);
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                hideMessages();
            }, 3000);
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
        }
        
        function hideMessages() {
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
            
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerHTML = 'LOGIN';
            loginBtn.disabled = false;
        }
    </script>
  <script src="/Functions/tabFunc.js"></script>
</body>
</html>
